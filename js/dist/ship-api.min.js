!function(a){"use strict";a.fn.shipApi=function(b){var c=a.extend({url:"https://api.laivadata.fi/v1",size:10},b);a(this).html(renderShipApiSearchControls());var d=0,e=0,f="",g=!1,h=a(this);c.prevSearches&&a(this).find(".ship-api-previous-searches").append(c.prevSearches),a(window).scroll(function(){a(window).scrollTop()+a(window).height()>a(document).height()-100&&!g&&e>0&&d<e&&(g=!0,d+=c.size,m())}),h.on("ship-select",function(a,b,d){"function"==typeof c.onShipSelect&&c.onShipSelect(b,d)}),h.on("before-search",function(a,b){"function"==typeof c.beforeSearch&&c.beforeSearch(b)}),h.on("after-search",function(a,b){"function"==typeof c.afterSearch&&c.afterSearch(b)});var i=a(this).find(".main-search-input");if(i.length<1)throw new Error("Search input field missing, is your theme ok?");var j=a(this).find(".main-search-results");if(j.length<1)throw new Error("Search results container missing, is your theme ok?");var k=a(this).find(".ship-api-load-container");if(k.length<1)throw new Error("Load container missing, is your theme ok?");var l=a(this).find(".main-search-btn");if(l.length<1)throw new Error("Search button missing, is your theme ok?");j.on("click",".searchresult",function(){var b=a(this).attr("data-ship-id"),d=(a(this).attr("data-ship-name"),a(this).attr("data-ship-buildnumber"));d?a.getJSON(c.url+"/attachments?buildnumber="+d,function(d){a.getJSON(c.url+"/ships/"+b,function(a){a.attachments=d,h.trigger("ship-select",[a,renderShipApiDetailModal({ship:a,apiurl:c.url})])})}):a.getJSON(c.url+"/ships/"+b,function(a){h.trigger("ship-select",[a,renderShipApiDetailModal({ship:a,apiurl:c.url})])})});var m=function(){0==d&&h.trigger("before-search",{query:f,offset:d,size:c.size}),k.show(),a.getJSON(c.url+"/ships?q="+f+"&from="+d+"&size="+c.size,function(a){e=a.hits.total;for(var b=[],i=0;i<a.hits.hits.length;i++){var l=a.hits.hits[i];l._source._id=l._id,b.push(l._source)}0==d?(j.html(renderShipApiSearchresults({ships:b,offset:d,size:c.size,total:e})),h.trigger("after-search",{query:f,offset:d,size:c.size})):j.find("tbody").append(renderShipApiSearchresultRows({ships:b,offset:d,size:c.size,total:e})),k.hide(),g=!1})};h.on("find-ships",function(a,b){i.val(b),l.click()}),h.on("set-prev-searches",function(a,b){h.find(".ship-api-previous-searches").empty(),h.find(".ship-api-previous-searches").append(b)}),l.click(function(){f=i.val(),d=0,m()}),i.keyup(function(a){13==a.keyCode&&l.click()})}}(jQuery);